<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JEDINING 原価管理</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; -webkit-tap-highlight-color: transparent; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="bg-slate-100 text-slate-900 min-h-screen">
    <div id="root"></div>

    <!-- React and Firebase SDKs -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        const firebaseConfig = {
  apiKey: "AIzaSyAIKfiw6uFGQOYGMbsmIuZClf8zvVw1sXI",
  authDomain: "jedining-ab069.firebaseapp.com",
  projectId: "jedining-ab069",
  storageBucket: "jedining-ab069.firebasestorage.app",
  messagingSenderId: "691552810598",
  appId: "1:691552810598:web:69f9e70c8eba31198a5fa7",
  measurementId: "G-GP4DVVCYFC"
};


        // Firebaseの初期化
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const menuCollection = collection(db, "menu_items");

        // Reactコンポーネント
        const { useState, useEffect } = React;
        const { Plus, Trash2, ChefHat, Calculator, TrendingUp } = lucide;

        function App() {
            const [items, setItems] = useState([]);
            const [name, setName] = useState('');
            const [cost, setCost] = useState('');
            const [price, setPrice] = useState('');

            // データのリアルタイム読み込み
            useEffect(() => {
                const q = query(menuCollection, orderBy("timestamp", "desc"));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setItems(data);
                });
                return () => unsubscribe();
            }, []);

            // 保存処理
            const saveItem = async (e) => {
                e.preventDefault();
                if (!name || !cost || !price) return;
                
                const margin = Number(price) - Number(cost);
                const marginRate = ((margin / Number(price)) * 100).toFixed(1);

                await addDoc(menuCollection, {
                    name,
                    cost: Number(cost),
                    price: Number(price),
                    margin,
                    marginRate,
                    timestamp: new Date()
                });

                setName(''); setCost(''); setPrice('');
                lucide.createIcons();
            };

            // 削除処理
            const deleteItem = async (id) => {
                if(confirm("このデータを削除しますか？")) {
                    await deleteDoc(doc(db, "menu_items", id));
                }
            };

            return (
                <div className="max-w-md mx-auto min-h-screen flex flex-col pb-10">
                    <header className="bg-indigo-600 text-white p-6 rounded-b-[2rem] shadow-xl mb-6">
                        <div className="flex items-center gap-3 mb-2">
                            <ChefHat size={28} />
                            <h1 className="text-2xl font-black italic">JEDINING COST</h1>
                        </div>
                        <p className="text-indigo-100 text-sm opacity-80 font-medium tracking-wide">原価・利益管理システム</p>
                    </header>

                    <main className="px-4 space-y-6">
                        {/* 入力フォーム */}
                        <form onSubmit={saveItem} className="bg-white p-6 rounded-3xl shadow-sm space-y-4">
                            <div className="flex items-center gap-2 mb-2">
                                <Plus size={18} className="text-indigo-600" />
                                <h2 className="font-bold text-slate-700">新規登録</h2>
                            </div>
                            <input 
                                type="text" placeholder="メニュー名" value={name} onChange={e=>setName(e.target.value)}
                                class="w-full p-4 bg-slate-50 border-none rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500 transition-all"
                            />
                            <div className="grid grid-cols-2 gap-3">
                                <input 
                                    type="number" placeholder="原価 (¥)" value={cost} onChange={e=>setCost(e.target.value)}
                                    class="w-full p-4 bg-slate-50 border-none rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500 transition-all"
                                />
                                <input 
                                    type="number" placeholder="売価 (¥)" value={price} onChange={e=>setPrice(e.target.value)}
                                    class="w-full p-4 bg-slate-50 border-none rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500 transition-all"
                                />
                            </div>
                            <button type="submit" className="w-full bg-indigo-600 text-white font-bold py-4 rounded-2xl shadow-lg shadow-indigo-200 active:scale-95 transition-all">
                                データを保存する
                            </button>
                        </form>

                        {/* リスト表示 */}
                        <div className="space-y-3">
                            <div className="flex items-center justify-between px-2">
                                <h2 className="text-[10px] font-black text-slate-400 uppercase tracking-widest">登録済みメニュー</h2>
                                <span className="text-[10px] font-bold bg-slate-200 px-2 py-0.5 rounded-full">{items.length}件</span>
                            </div>
                            {items.map(item => (
                                <div key={item.id} className="bg-white p-4 rounded-2xl shadow-sm border border-slate-50 flex justify-between items-center group">
                                    <div className="flex-1">
                                        <h3 className="font-bold text-slate-800">{item.name}</h3>
                                        <div className="flex items-center gap-3 mt-1">
                                            <span className="text-xs text-slate-400">¥{item.cost.toLocaleString()} → ¥{item.price.toLocaleString()}</span>
                                            <div className="flex items-center gap-1 text-emerald-600 font-black text-sm">
                                                <TrendingUp size={14} />
                                                <span>{item.marginRate}%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <button onClick={() => deleteItem(item.id)} className="text-slate-200 hover:text-rose-400 p-2 transition-colors">
                                        <Trash2 size={20} />
                                    </button>
                                </div>
                            ))}
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
